# 第1章 概述

## 计算机网络在信息时代的作用

常见的网络分为三大类：
- 电信网络
- 有线电视网络
- 计算机网络

其中 **计算机网络** 是核心

互联网即因特网，是 *Internet* 的译名

> [!Attention]
> 注意区分 Internet 和 internet
> - internet：是一个通用名词，泛指多个计算机网络互连而成的网络
> - Internet：是一个专用名词，特指因特网--世界上最大的计算机网络

互联网的两个基本特点：
- 连通性
- 共享性

互联网+：指的是 互联网 + 各个传统行业

## 互联网概述

### 网络的网络

计算机网络由 **多个结点和连接结点的链路** 组成。结点可以是 **计算机、集线器或路由器** 等
网络之间可以通过 **路由器** 互连起来，构成 **网络的网络**，称为 **互联网**

- 网络将许多计算机连接在一起
- 互联网则把网络通过路由器连在一起

与网络相连的计算机称为 **主机**

### 互联网基础结构发展的三个阶段

因特网发展的三个阶段
- **第一阶段**：从单个网络 *ARPANET* 向互联网发展的过程。1983 年 *TCP/IP* 协议成为 *ARPANET* 上的标准协议。
- **第二阶段**：建成三级结构的因特网：主干网、地区网和校园网（或企业网）。
- 形成多层次的ISP（*Internet Service Provider* 因特网服务提供者）结构的因特网

> [!tip]
> ISP（*Internet Service Provider* 因特网服务提供者）
> 
> 常见的如中国电信、中国移动和中国联通都是 *ISP*
> 
> 上网就是指接入到互联网。主机必须有 *IP* 地址才能上网。
> *ISP* 从互联网管理机构申请到很多 *IP* 地址，同时拥有通信线路及路由器等联网设备。
> 用户向 *ISP* 交纳费用获得所需 *IP* 地址的使用权，然后就可以通过该 *ISP* 接入互联网。
> 
> 互联网由全球无数的 *ISP* 所共同拥有。
> **万维网**（WWW） 是基于互联网开发的一种信息共享服务，浏览网址一般使用的就是万维网，而邮件等就没有用到万维网。

### 互联网标准化工作

标准的分类
- **法定标准**：由权威机构指定的正式的、合法的标准，如 *OSI*
- **事实标准**：某些公司的产品在竞争中占据主流，时间长了这些产品中的协议和技术就成了标准，如 *TCP/IP*

> *RFC（request for comments）*

*RFC* 是因特网标准的形式，*RFC* 要上升为因特网正式标准的四个阶段：
1. **因特网草案（*Internet Draft*）**：这个阶段还不是 *RFC* 文档
2. **建议标准（*Proposed Standard*）**：这个阶段开始正式成为 *RFC* 文档
3. **草案标准（*Draft Standard*）**：将 *RFC* 文档交由 *IETF* 和 *IAB* 进行审核，已将取消此步骤
4. **因特网标准（*Internet Standard*）**

> 标准化工作的相关组织

- 国际标准化组织 *ISO*：*OSI* 参考模型，*HDLC* 协议
- 国际电信联盟：指定通信规则
- 国际电气电子工程师协会 *IEEE*：学术机构，*IEEE802* 系列标准，*5G* 协议的制定
- *Internet* 工程任务组 *IETF*：复制因特网相关标准的制定，*RFC xxx*

## 互联网的组成

互联网按照工作方式划分为 **边缘部分** 和 **核心部分**
- **边缘部分**：由连接到互联网的主机组成，作用是 **进行信息处理**
- **核心部分**：由大量网络和连接网络的路由器组成，作用是 **按存储转发的方式进行分组交换**，为边缘部分提供通信服务

### 互联网的边缘部分

**主机** 又称作 **端系统**（个人电脑，手机，摄像头等都属于端系统）

边缘部分利用核心部分提供的服务进行通信，一般称为 **计算机间的通信**

计算机之间的通信：实际上是 **不同计算机上某个进程之间的通信**

通信方法主要有两类：
- **客户-服务器** 方式
  - 客户程序：
    - 用户调用后，在通信时主动向远地服务器发起通信（请求服务）。因此，**客户程序必须知道服务器程序的地址**
    - 不需要特殊的硬件和复杂的操作系统
  - 服务器程序：
    - 一种专门提供服务的程序，可 **同时处理多个客户的请求**
    - 系统启动后即自动调用不断运行，**被动** 等待接受客户的通信请求。因此，**服务器程序不需要知道客户程序的地址**
    - 一般需要强大的硬件和操作系统支持
- **对等** 方式（*p2p*）
  - 两台主机不区分服务器和客户，主要都运行 *p2p* 软件，就可以进行 **平等对等连接通信**，双方都可以访问对方硬盘中的共享文档，可支持大量对等用户同时工作

> [!tip]
> 客户-服务器方式
> 
> 一方请求服务，一方提供服务，通信可以是单向的，也可以是双向的
> 
> 客户和服务器：指通信中涉及的两个 **应用进程**，客户是服务请求方，服务器是服务提供方

### 互联网的核心部分

核心部分最重要的功能是 **分组交换**，其主要组件时 **路由器**（用于转发分组）

> **分组交换**
> 
> 要发送的整块数据 称为一个 **报文**，将报文分成多个数据段，每个数据段加上一个 **首部（报头）** 构成一个 **分组（包）**
> 
> 分组交换采用 **存储转发技术**：路由器接到分组后，先暂时存储，检查首部，查找转发表，然后按照首部中的目的地址，找到合适的接口转发给下一个路由器，这样一步步的交付给最终的目的主机
> 
> **首部** 中主要包含 **目的地址、源地址** 等控制信息
> 
> 分组是在互联网中传送数据的单元

### 三种交换方式
- **电路交换**：三个步骤
  1. 建立连接（占用通信资源 ，一条专用的物理通路）
  2. 通话（一直占用通信资源）
  3. 释放连接（归还通信资源）
  - 缺点：在通话的全部时间始终占用端到端的通信资源
  - 应用：电话使用的就是电路交换，而互联网数据因为其 **突发性**，使用电路交换的话效率很低
- **报文交换**：整个报文先传送到相邻结点，全部存储下来后查找转发表，转发到下一个结点
- **分组交换**：单个分组传送到相邻结点，存储下来后查找转发表，转发到下一结点

![三种交换方式](images/clipboard.png)

## 计算机网络的类别

> 按照网络的 **作用范围** 分类

- **广域网** *（WAN）*：作用范围几十到几千公里，是互联网的核心部分，其任务是通过长距离运送主机所发送的数据，广域网各结点采用高速链路，有较大通信容量
- **城域网** *（ MAN）*：作用范围一个城市，用来将多个局域网进行互联，多采用以太网技术
- **局域网** *（LAN）*：作用范围1km左右，一般用微机或工作站通过高速通信线路相连
- **个人区域网** *（PAN）*：作用范围10m左右，把个人工作的地方属于个人的设备用无线技术相连，也叫 **无线个人区域网** *(WPAN)*

> 按照网络的 **使用者** 分类

- **公用网**：电信公司出资建造的大型网络，任何人都可付费使用，也称 **公众网**
- **专用网**：为满足特殊业务需要建立的网络，不向外人提供服务
- **接入网**：用来把用户进入到互联网的网络，又称 **本地接入网** 或 **居民接入网**

## 计算机网络性能

**性能指标** 是从定量来描述计算机通信网络的特征

**非性能特征** 是从定性来描述计算机通信网络的特征

### 计算机网络的性能指标

> 速率

**速率** 是指连接在计算机网络上的主机在数字信道上传送数据的速率。是计算机网络中最重要的一个性能指标。

速率又称 **数据率** *（data rate）* 或 **比特率** *（bit rate）*，单位是 $bit/s$ （比特每秒）

当速率较高时，常常在 $bit/s$ 前加上一个字母，例如 $k(kilo)=10^3$，$M(Mega)=10^6$，$G(Giga)=10^9$

> [!ATTENTION]
> 速率往往指额定速率或标称速率，并非网络上实际运行的速率

> 带宽

- 带宽：本意是指某个信号具有的 **频带宽度**，信号的带宽是指该信号所包含的各种不同频率成分所占据的频率范围。
- 在计算机网络中，**带宽指网络的通信线路传送数据的能力**（单位时间内从网络中的某一个点到另外一个点所能通过的 **最高数据率**,带宽的单位为 $bit/s$）。

> [!tip]
> 带宽有两种不同的意义，在上述描述中，前者为 **频域称谓**，后者为 **时域称谓**，但其本质是相同的。也就是说，**一条通信链路，带宽越宽，所能传输的最高数据率也越高。**

> 吞吐量

- 吞吐量表示单位时间内通过某个网络（通信线路、接口）的实际的数据量。单位为 $bit/s$
- 吞吐量受制于带宽或者网络的额定速率。

例如：对于一个1Gbit/s的以太网，意味着其额定速率为1Gbit/s，那么这个数值也是该以太网的吞吐量的绝对上限值。

> 时延

时延（*delay* 或 *latency*）是指数据（一个报文或分组，甚至比特）从网络(或链路)的一端传送到另一端所需的 **时间**。有时也称为延迟或迟延。

时延由以下几个部分组成

| 时延类型 |                             解释                             |
| :------: | :----------------------------------------------------------: |
| 发送时延 |              主机或路由器发送数据帧所需要的时间              |
| 传播时延 |          电磁波在信道中传播一定的距离需要花费的时间          |
| 处理时延 |       主机或者路由器接受到分组时要花费一定的时间去处理       |
| 排队时延 | 分组在网络传输时，进入路由器后要在输入队列中排队等待处理，<br />路由器确定转发接口后，还要在输出队列中排队等待转发，这就是排队时延 |

- **发送时延**：是从发送数据帧的第一个比特算起,到该帧的最后一个比特发送完毕所需的时间，计算公式：$\displaystyle \text{发送时延}=\frac{\text{数据数据帧长度(比特)}}{\text{发送速率(比特/秒)}}$
- **传播时延**：计算公式：$\displaystyle \text{传播时延}=\frac{\text{信道长度(米)}}{\text{信号在信道上的传播速率(米/秒)}}$
- **处理时延**：与结点的性能和处理方法有关。
- **排队时延**：排队时延的长短往往取决于网络中当时的通信量。**当网络的通信量很大时若发生队列溢出，使分组丢失，相当于排队时延为无穷大。**

总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延

> [!tip]
> **发送速率** 和 **传播速率**
> 
> 对于高速网络链路，我们提高的不是比特在链路上的传播速率，而是数据的发送速率。
> 
> 载荷信息的电磁波在通信线路上的传播速率取决于通信线路的介质材料。提高数据的发送速率只是减少了数据的发送时延。
> 
> 因此
> 
> 我们通常所说的”光纤信道的传输速率高“是指可以用很高的速率向光纤信道发送数据，而光纤信道的传播速率实际上还要比铜线的传播速率略低一点。

> 时延带宽积

时延带宽积指 **传播时延\*带宽**，表示一条链路上传播的所有比特（以比特为单位）。

链路的时延带宽积又称为以比特为单位的链路长度

> 往返时间 *RTT*

往返时间 *RTT (Round-Trip Time)* 表示从发送端发送数据开始，到发送端收到来自接收端的确认（接收端收到数据后立即发送确认），总共经历的时延。

> 利用率

- 信道利用率指出某信道有百分之几的时间是被利用的（有数据通过）。完全空闲的信道的利用率是零
- 网络利用率则是全网络的信道利用率的加权平均值。
- **信道利用率并非越高越好。**

根据排队论的理论，当某信道的利用率增大时，该信道引起的时延也迅速增加。

令 $D_0$ 表示网络空闲时的时延，$D$ 表示网络当前的时延，那么在适当的假定条件下，可以用下面的简单公式来表示 $D$，$D_0$ 和利用率 $U$ 之间的关系
$$
D = \frac{D_0}{1-U}
$$

其中 $U$ 是网络利用率，数值介于 $0$ 和 $1$ 之间

> [!ATTENTION] 
> 当网络的利用率达到其容量的 $1/2$ 时，时延就要加倍。且，当网络的利用率接近最大值 $1$ 时，网络的时延就趋于无穷大。
> 
> 信道利用率过高会产生非常大的时延

![利用率](images/利用率曲线.png)

### 计算机网络的非性能指标

- 费用
- 质量
- 标准化
- 可靠性
- 可扩展性和可升级性
- 易于管理和维护
- ...

## 计算机网络体系结构

### 协议与划分层次

两个概念
- **网络协议** （协议）：为进行网络中的数据交换而建立的规则、标准或约定
- **计算机网络体系结构**：计算机网络各层及其协议的集合

> 网络协议三要素
>
> **语法**：数据与控制信息的结构或格式
> 
> **语义**：需要发出何种控制信息，完成何种动作以及做出何种响应
> 
> **同步**：事件实现顺序的详细说明

分层的优点：
- 各层之间是 **独立** 的：某一层不需要知道下一层如何实现，只需要知道接口提供的服务
- **灵活性高**：当一层发生变化时，只要保证接口不变，就能方便修改
- **结构上可分割**：各层可以采用最合适的方式实现
- 易于 **实现** 和 **维护**：这种结构使实现和调试一个庞大复杂的系统更容易，因为整个系统以被分解成若干相对独立的子系统
- 促进 **标准化**：因每层的功能及其提供的服务都已经精确说明

各层需要完成的工作包括以下一种或多种：
- **差错控制**：使得对应层次对等方的通信更可靠
- **流量控制**：发送端的发送速率必须使接收端来得及接收
- **分段和重装**：发送端将要发送的数据块划分为更小单位，在接收端将其还原
- **复用和分用**：发送端几个高层会话复用一条底层的连接，在接收端再进行分用
- **连接建立和释放**：交换数据前先建立一条逻辑连接，数据传送结束后释放连接

### 具有五层协议的体系结构

不同体系结构如下图所示

![体系结构](images/体系结构.png)

> 应用层

任务：通过 **应用进程** 间的交互来完成特定网络应用，应用层协议定义的是 **应用进程间通信和交互** 的规则

常见应用层协议：
- 域名系统 *DNS*
- 支持万维网应用的 *HTTP* 协议
- 支持电子邮件的 *SMTP* 协议
- ...

应用层交互的数据单元称为 **报文**

> 运输层

任务：负责向两台主机中 **进程之间的通信提供通用的数据传输服务**，应用进程利用该服务传送应用层报文；通用指多种应用可以使用同一运输层服务；有 **复用** 和 **分用** 功能

> [!tip]
> **复用** 和 **分用**
> 
> - **复用**：多个应用层进程可同时使用下面运输层的服务
> - **分用**：运输层把收到的信息分别交付上面应用层中的相应进程

两种主要协议：
- **传输控制协议** *TCP*：提供 **面向连接的**、**可靠的** 数据传输服务。数据传输的单位是 **报文段**
- **用户数据报协议** *UDP*：提供 **无连接的**、**尽最大努力的** 数据传输服务，不保证数据传输的可靠性。数据传输的单位是 **用户数据报**

> 网络层

任务：**负责为分组交换网上不同主机** 提供通信服务。在发送数据时，网络层把运输层产生的报文段或用户数据报 **封装成分组或包进行传送**；选择合适路由，使运输层传下来的分组能通过网络中的路由器找到目的主机

协议：
- *TCP/IP* 体系中，**网络层使用 *IP* 协议**，因此分组也叫 *IP* **数据报**，或简称数据报，但注意这与用户数据报不同。
- 互联网使用 **无连接的网际协议** *IP*。
- 多种路由选择协议

> [!tip]
> 无论哪一层的数据单元，都可以笼统地用 “**分组**” 来表示。

> 数据链路层

任务：将网络层交下来的 *IP* 数据报组装成 **帧**，在 **两个相邻结点的链路上** 传送 **帧**。

每一帧包括 **数据和必要的控制信息**（包括同步信息、地址信息、差错控制等）。

> 物理层

任务：考虑用多大电压代表0或1，如何识别对方发送的比特；确定电缆插头的物理结构。

物理层的传输单位是 **比特**

数据在各层之间的传递过程如下图所示

![传递过程](images/数据传递.png)

对上图解析：

第5层、第4层、第3层分别为数据加上了属于本层的控制信息，都位于首部。第2层的控制信息分为两部分加到了首部和尾部。

对等层次间的数据单位称为该层的 **协议数据单元**。

**在路由器中**，**分组上升到第3层**，过程中每一层都根据控制信息进行必要的操作并将该控制信息剥去。在第三层根据首部中的目的地址查找路由器中的转发表，找出转发分组的接口，然后依次加上新的控制信息下降到第1层，将数据发送出去。

上图可以发现网际层的控制信息用于整个网络，而链路层的控制信息仅用于两个节点之间。路由器只到第3层。

### 实体、协议、服务和服务访问点

- **实体**：表示任何可发送或接受信息的 **硬件或软件进程**；很多情况下，实体就是一个特点的软件模块
- **协议**：控制两个或多个 **对等实体** 进行通信的规则的集合
- **服务**：由 **下层向上层** 通过层间接口提供的功能
- **服务访问点**：在同一系统相邻两层的时间进行交互的地方，实际上就是一个 **逻辑接口**

> [!tip]
> 协议与服务
> 
> 在协议的控制下，两个 **对等实体间** 的通信使得本层能够向上一层提供服务。要实现本层协议，还需要使用下面层提供的服务
> 
> **协议** 是"**水平的**"，即协议是控制对等实体间通信的规则，**服务** 是"**垂直的**"，即服务是由下层向上层通过接口提供的

### TCP/IP体系结构

技术的发展不严格遵循分层概念，事实上现在某些应用程序可以直接使用 *IP* 层甚至网络接口层，如下图。

![tcpip](images/tcpip.png)

*TCP/IP* **协议族** 中的多种协议如下所示：

![tcpip协议](images/tcpip协议.png)

*TCP/IP* 协议可为各式各样的应用提供服务(*everthing over IP*)；*TCP/IP* 也允许 *IP* 协议在各式各样的网络构成的互联网上运行(*IP over everthing*)

 


